import sys
import socket

def ip_validator(ip):
    """Validates IP address"""
    ip_split = ip.split('.') #Splits each octet into one list 
    try:            
        if len(ip_split) != 4: #checks if the list's length is 4 
            sys.exit('Error: IP address given is not a valid length.')
        
        for index in range(len(ip_split)): 
            isinstance(int(ip_split[index]),int) #Checks if there are any invalid characters
        print('IP validated successfully')
        return True
    except ValueError:
        sys.exit('Error: IP is not valid (Did you accidentally input a letter?')
    

def ip_input():
    """Input the IP IPV4"""
    ip = input('Please enter an ip address: ')
    return ip

def port_range():
    """Asks the user for a port range"""
    begin_port = int(input('Please enter the port you would like to start at: ')) #Starting port
    end_port = int(input('Please enter the last port you would like to scan: ')) #Ending port
    end_port +=1
    return range(begin_port,end_port)

def socket_check(ip,port):
    """Checks if the sockets are open"""
    sock = socket.socket()
    
    try:
       if sock.connect((ip, port)) == None:
            print(f'Socket: {ip}:{port} available.')

    except ConnectionRefusedError:
        print(f'Port: {port} not available.')
    except OSError:
        print(f'Error: firewall denied permission on port {port}')



def main():
    """Runs the functions"""
    ip = ip_input()
    if ip_validator(ip) == True: #If the IP is validated successfully, it'll continue to ask for a range of ports and then run a for-loop to see which sockets are open.
        ports = port_range()
        for port_num in ports:
            socket_check(ip,port_num)
    
main()