import sys
import socket

#The use of this app is to search for open ports on a network

def ip_validator(ip):
    """Validates IP address"""
    ip_split = ip.split('.') #Splits each octet into one list 
    try:            
        if len(ip_split) != 4: #checks if the list's length is 4 
            sys.exit('Error: IP address given is not a valid length.')
        
        for index in range(len(ip_split)): 
            isinstance(int(ip_split[index]),int) #Checks if there are any invalid characters
        return True
    except ValueError:
        sys.exit('Error: IP is not valid (Did you accidentally input a letter?')
    

def ip_input():
    """Input the IP IPV4"""
    ip = input('Please enter an ip address: ')
    return ip

def port_range():
    """Asks the user for a port range"""
    try:
        begin_port = int(input('Please enter the port you would like to start at: ')) #Starting port
        end_port = int(input('Please enter the last port you would like to scan: ')) #Ending port
        end_port +=1
        return range(begin_port,end_port)
    except ValueError:
        sys.exit('Error: You have input an invalid range.')

def socket_check(ip,port): #IP has to be a string, port has to be a INT
    """Checks if the sockets are open"""
    sock = socket.socket()
    TGREEN =  '\033[32m' # Green Text
    TWHITE = '\033[37m'
    try:
       if sock.connect((ip, port)) == None:
            print(f' {TGREEN}[ AVAILABLE ] Port: {port} is available.',TWHITE)

    except ConnectionRefusedError:
        print(f'Port: {port} not available.')
    except OSError:
        print(f'Error: firewall denied permission on port {port}')

def main():
    """Runs the functions"""
    ip = ip_input()
    if ip_validator(ip) == True: #If the IP is validated successfully, it'll continue to ask for a range of ports and then run a for-loop to see which sockets are open.
        ports = port_range()
        for port_num in ports:
            socket_check(ip,port_num)
    
main()